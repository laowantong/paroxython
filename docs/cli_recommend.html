<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>paroxython.cli_recommend API documentation</title>
<meta name="description" content="Read and execute a pipeline of commands and report the learning costs …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<a href="https://github.com/laowantong/paroxython"><img style="position: absolute; top: 0; right: 0; border: 0; width: 150px; height: 150px" src="https://laowantong.github.io/paroxython/resources/source_on_github.png" alt="Source on GitHub"></a>
<style>.homelink{display:block}.homelink:hover{color:inherit}.homelink img{margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="https://laowantong.github.io/paroxython/cli_recommend.html">
<link rel="icon" href="https://laowantong.github.io/paroxython/resources/logo.png">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>paroxython.cli_recommend</code></h1>
</header>
<section id="section-intro">
<p>Read and execute a pipeline of commands and report the learning costs.</p>
<h2 id="usage">Usage</h2>
<pre><code>paroxython recommend [options] DB_PATH
</code></pre>
<h2 id="description">Description</h2>
<pre>Requires an existing database previously generated by the command:

    paroxython collect DIRECTORY

... and a pipeline of commands describing which concepts (taxa) are
already known, which ones need to be illustrated or must be avoided. By
default, it results in a list of recommended programs, along with their
total learning costs and the individual learning cost of each of the
concepts they feature. These results are presented in Markdown format.
With the option `-o stdout` the program list is simply printed to stdout.
</pre>
<h2 id="shortcut">Shortcut</h2>
<pre>For DB_PATH, instead of the path of a tag database, you can provide the
DIRECTORY previously collected. Paroxython will automatically look for the
tag database at DIRECTORY/../DIRECTORY_db.json.
</pre>
<h2 id="options">Options</h2>
<pre>-b --base=PATH      Value accessible, with the syntax &quot;{base}&quot;, by any shell
                    command of the pipeline. If not specified, this is the
                    parent directory of DB_PATH. [default: ]
-c --cost=STR       Learning cost assessment strategy. [default: zeno]
                    Currently available:
                    • zeno: the i-th edge of a taxon, if not already
                            imparted, costs 2^(-i). For instance, the taxon
                            old/new/new will costs 2^-2 + 2^-3 = 0.375.
                    • linear: simply count the number of new edges.
-o --output=PATH    The path of the resulting report. If it is omitted, a
                    value of PREFIX_recommendations.md is inferred from the
                    path PREFIX_db.json of DB_PATH. If it is STDOUT, the
                    sorted list of recommended (but not hidden) programs, is
                    printed on the standard output. [default: ]
-p --pipe=PATH      Path of the command pipeline. If it is omitted, a value
                    of PREFIX_pipe.py is inferred from the path
                    PREFIX_db.json of DB_PATH. If is is &lt;code&gt;\[]&lt;/code&gt;, no filter is
                    applied. [default: ]
-f --format=STR     The format of program titles in the report. This string
                    can contains the following identifiers (between braces):
                    • name: filename of the program.
                    • path: program key in the DB &quot;programs&quot; dictionary.
                    • prefix: name of DB_PATH, minus any &quot;_db.json&quot; suffix.
                    • absolute: absolute path to DB_PATH's parent folder.
                    • relative: relative path to DB_PATH's parent folder.
                    Shortcut: if format is &quot;vscode&quot;, makes program names to
                        be clickable and opening in VS Code.
                    [default: `{name}`]
</pre>
<h2 id="example">Example</h2>
<pre>Use `-o stdout` to pipe the results into another shell command. For instance,
let's assume that:

- your program repository is `path/to/programs`;
- your tag database is at its default location `path/to/programs_db.json`;
- your pipeline is at its default location `path/to/programs_pipe.py`.

Then, to copy (not move) all the recommended programs to an existing
directory DEST, just do:

paroxython recommend -o stdout path/to/programs_db.json \
    | xargs  -I {} sh -c &quot;cp path/to/programs/{} DEST&quot;
</pre>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/cli_recommend.py#L0-L141" class="git-link">Browse GitHub</a>
</summary>
<pre><code class="python">import json
import sys
from pathlib import Path

import regex  # type: ignore
from typed_ast.ast3 import literal_eval

from .goodies import print_success, print_exit
from .recommend_programs import Recommendations


def cli_wrapper(args):
    db_path = Path(args[&#34;DB_PATH&#34;])
    if not db_path.exists():
        print_exit(f&#34;no file or directory at &#39;{db_path.absolute()}&#39;: aborted.&#34;)
    parent_path = db_path.parent
    if db_path.is_dir():
        for suffix in (&#34;_db&#34;, &#34;-db&#34;):
            db_path = parent_path / f&#34;{db_path.name}{suffix}.json&#34;
            if db_path.is_file():
                print(f&#34;Using database &#39;{db_path}&#39;.&#34;)
                break
        else:
            print_exit(f&#34;unable to locate a tag database in &#39;{parent_path}&#39;: aborted.&#34;)
    m = regex.fullmatch(r&#34;(.+[_-])db\.json&#34;, db_path.name)
    prefix = m[1] if m else &#34;&#34;
    pipeline_path = Path(args[&#34;--pipe&#34;] or parent_path / f&#34;{prefix}pipe.py&#34;)
    if pipeline_path.is_file():
        print(f&#34;Using pipeline &#39;{pipeline_path}&#39;.&#34;)
        try:
            commands = literal_eval(pipeline_path.read_text())
        except Exception:  # Too many possible exceptions
            print_exit(f&#34;Malformed pipeline: aborted.&#34;)
    elif args[&#34;--pipe&#34;] == &#34;[]&#34;:
        print(&#34;Using an empty pipeline.&#34;)
        commands = []
    else:
        print_exit(f&#34;No pipeline at &#39;{pipeline_path}&#39;: aborted.&#34;)
    stdout_backup = sys.stdout
    if args[&#34;--output&#34;].upper() == &#34;STDOUT&#34;:
        sys.stdout = sys.stderr
    title_format = args[&#34;--format&#34;]
    if title_format.lower() == &#34;vscode&#34;:
        title_format = &#34;[`{name}`](vscode://file/{absolute}/{prefix}/{path})&#34;
    title_format = title_format.format(
        name=&#34;{name}&#34;,
        path=&#34;{path}&#34;,
        prefix=prefix.rstrip(&#34;_-&#34;),
        absolute=parent_path.resolve(),
        relative=parent_path,
    )
    rec = Recommendations(
        db=json.loads(db_path.read_text()),
        base_path=Path(args[&#34;--base&#34;] or parent_path),
        assessment_strategy=args[&#34;--cost&#34;],
        title_format=title_format,
    )
    rec.run_pipeline(commands)
    if args[&#34;--output&#34;].upper() == &#34;STDOUT&#34;:
        sys.stdout = stdout_backup
        return print(&#34;\n&#34;.join(sorted(rec.selected_programs - rec.hidden_programs)))
    output_path = Path(args[&#34;--output&#34;] or parent_path / f&#34;{prefix}recommendations.md&#34;)
    output_path.write_text(rec.get_markdown())
    print_success(f&#34;Dumped: {output_path.resolve()}\n&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="paroxython.cli_recommend.cli_wrapper"><code class="name flex">
<span>def <span class="ident">cli_wrapper</span></span>(<span>args)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/cli_recommend.py#L90-L142" class="git-link">Browse GitHub</a>
</summary>
<pre><code class="python">def cli_wrapper(args):
    db_path = Path(args[&#34;DB_PATH&#34;])
    if not db_path.exists():
        print_exit(f&#34;no file or directory at &#39;{db_path.absolute()}&#39;: aborted.&#34;)
    parent_path = db_path.parent
    if db_path.is_dir():
        for suffix in (&#34;_db&#34;, &#34;-db&#34;):
            db_path = parent_path / f&#34;{db_path.name}{suffix}.json&#34;
            if db_path.is_file():
                print(f&#34;Using database &#39;{db_path}&#39;.&#34;)
                break
        else:
            print_exit(f&#34;unable to locate a tag database in &#39;{parent_path}&#39;: aborted.&#34;)
    m = regex.fullmatch(r&#34;(.+[_-])db\.json&#34;, db_path.name)
    prefix = m[1] if m else &#34;&#34;
    pipeline_path = Path(args[&#34;--pipe&#34;] or parent_path / f&#34;{prefix}pipe.py&#34;)
    if pipeline_path.is_file():
        print(f&#34;Using pipeline &#39;{pipeline_path}&#39;.&#34;)
        try:
            commands = literal_eval(pipeline_path.read_text())
        except Exception:  # Too many possible exceptions
            print_exit(f&#34;Malformed pipeline: aborted.&#34;)
    elif args[&#34;--pipe&#34;] == &#34;[]&#34;:
        print(&#34;Using an empty pipeline.&#34;)
        commands = []
    else:
        print_exit(f&#34;No pipeline at &#39;{pipeline_path}&#39;: aborted.&#34;)
    stdout_backup = sys.stdout
    if args[&#34;--output&#34;].upper() == &#34;STDOUT&#34;:
        sys.stdout = sys.stderr
    title_format = args[&#34;--format&#34;]
    if title_format.lower() == &#34;vscode&#34;:
        title_format = &#34;[`{name}`](vscode://file/{absolute}/{prefix}/{path})&#34;
    title_format = title_format.format(
        name=&#34;{name}&#34;,
        path=&#34;{path}&#34;,
        prefix=prefix.rstrip(&#34;_-&#34;),
        absolute=parent_path.resolve(),
        relative=parent_path,
    )
    rec = Recommendations(
        db=json.loads(db_path.read_text()),
        base_path=Path(args[&#34;--base&#34;] or parent_path),
        assessment_strategy=args[&#34;--cost&#34;],
        title_format=title_format,
    )
    rec.run_pipeline(commands)
    if args[&#34;--output&#34;].upper() == &#34;STDOUT&#34;:
        sys.stdout = stdout_backup
        return print(&#34;\n&#34;.join(sorted(rec.selected_programs - rec.hidden_programs)))
    output_path = Path(args[&#34;--output&#34;] or parent_path / f&#34;{prefix}recommendations.md&#34;)
    output_path.write_text(rec.get_markdown())
    print_success(f&#34;Dumped: {output_path.resolve()}\n&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="Paroxython Home" href="index.html">
<img src="https://laowantong.github.io/paroxython/resources/logo.png" alt="Paroxython logo">
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="paroxython" href="index.html">paroxython</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="paroxython.cli_recommend.cli_wrapper" href="#paroxython.cli_recommend.cli_wrapper">cli_wrapper</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>